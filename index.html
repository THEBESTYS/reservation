<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë”ë² ìŠ¤íŠ¸ ì–´í•™ì› - ìƒë‹´ ì˜ˆì•½</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script>
        // Firebase êµ¬ì„±
        const firebaseConfig = {
            apiKey: "AIzaSyD4gK47WmW78znj1jXDzwMSCH6jAN_LVN8",
            authDomain: "reservation-33a24.firebasestorage.app",
            projectId: "reservation-33a24",
            storageBucket: "reservation-33a24.firebasestorage.app",
            messagingSenderId: "965824309420",
            appId: "1:965824309420:web:060c37983c1d1c38d59709"
        };
        
        // Firebase ì´ˆê¸°í™”
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        
        console.log('Firebase ì´ˆê¸°í™” ì™„ë£Œ');
    </script>
    <style>
        /* ... ê¸°ì¡´ CSS ì½”ë“œ ìœ ì§€ (ì „ì²´) ... */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Malgun Gothic', sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* ... ë‚˜ë¨¸ì§€ CSS ì½”ë“œëŠ” ëª¨ë‘ ë™ì¼í•˜ê²Œ ìœ ì§€ ... */
        
        .error-message {
            display: none;
            text-align: center;
            padding: 15px;
            background: #f8d7da;
            color: #721c24;
            border-radius: 5px;
            margin-top: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-calendar-check logo-icon"></i>
                <div>
                    <h1>ìƒë‹´ ì˜ˆì•½</h1>
                    <p>ë”ë² ìŠ¤íŠ¸ ì–´í•™ì› ì „ë¬¸ ìƒë‹´ ì„œë¹„ìŠ¤</p>
                </div>
            </div>
        </header>
        
        <a href="index.html" class="back-btn">
            <i class="fas fa-arrow-left"></i> ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°
        </a>
        
        <div class="reservation-form">
            <h2 class="form-title">
                <i class="fas fa-edit"></i> ì˜ˆì•½ ì •ë³´ ì…ë ¥
            </h2>
            
            <form id="reservationForm">
                <!-- í•™ìƒ ì •ë³´ -->
                <div class="form-group">
                    <label for="studentName"><i class="fas fa-user-graduate"></i> í•™ìƒ ì´ë¦„ *</label>
                    <input type="text" id="studentName" name="studentName" required placeholder="í™ê¸¸ë™">
                </div>
                
                <!-- í•™ë…„/ë°˜ -->
                <div class="form-group">
                    <label for="studentGrade"><i class="fas fa-graduation-cap"></i> í•™ë…„/ë°˜ *</label>
                    <select id="studentGrade" name="studentGrade" required>
                        <option value="">ì„ íƒí•´ì£¼ì„¸ìš”</option>
                        <option value="ì´ˆ1">ì´ˆë“±í•™êµ 1í•™ë…„</option>
                        <option value="ì´ˆ2">ì´ˆë“±í•™êµ 2í•™ë…„</option>
                        <option value="ì´ˆ3">ì´ˆë“±í•™êµ 3í•™ë…„</option>
                        <option value="ì´ˆ4">ì´ˆë“±í•™êµ 4í•™ë…„</option>
                        <option value="ì´ˆ5">ì´ˆë“±í•™êµ 5í•™ë…„</option>
                        <option value="ì´ˆ6">ì´ˆë“±í•™êµ 6í•™ë…„</option>
                        <option value="ì¤‘1">ì¤‘í•™êµ 1í•™ë…„</option>
                        <option value="ì¤‘2">ì¤‘í•™êµ 2í•™ë…„</option>
                        <option value="ì¤‘3">ì¤‘í•™êµ 3í•™ë…„</option>
                        <option value="ê³ 1">ê³ ë“±í•™êµ 1í•™ë…„</option>
                        <option value="ê³ 2">ê³ ë“±í•™êµ 2í•™ë…„</option>
                        <option value="ê³ 3">ê³ ë“±í•™êµ 3í•™ë…„</option>
                    </select>
                </div>
                
                <!-- ë³´í˜¸ì ì •ë³´ -->
                <div class="form-row">
                    <div class="form-group">
                        <label for="parentName"><i class="fas fa-user"></i> ë³´í˜¸ì ì´ë¦„ *</label>
                        <input type="text" id="parentName" name="parentName" required placeholder="í™ë¶€ëª¨">
                    </div>
                    
                    <div class="form-group">
                        <label for="parentPhone"><i class="fas fa-phone"></i> ë³´í˜¸ì ì—°ë½ì²˜ *</label>
                        <input type="tel" id="parentPhone" name="parentPhone" required placeholder="010-1234-5678">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="parentEmail"><i class="fas fa-envelope"></i> ì´ë©”ì¼</label>
                    <input type="email" id="parentEmail" name="parentEmail" placeholder="parent@email.com">
                </div>
                
                <!-- ì˜ˆì•½ ì •ë³´ -->
                <div class="form-row">
                    <div class="form-group">
                        <label for="reservationDate"><i class="fas fa-calendar"></i> ì˜ˆì•½ ë‚ ì§œ *</label>
                        <input type="date" id="reservationDate" name="reservationDate" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="reservationTime"><i class="fas fa-clock"></i> ì˜ˆì•½ ì‹œê°„ *</label>
                        <select id="reservationTime" name="reservationTime" required>
                            <option value="">ì„ íƒí•´ì£¼ì„¸ìš”</option>
                            <option value="09:00">09:00</option>
                            <option value="10:00">10:00</option>
                            <option value="11:00">11:00</option>
                            <option value="14:00">14:00</option>
                            <option value="15:00">15:00</option>
                            <option value="16:00">16:00</option>
                            <option value="17:00">17:00</option>
                            <option value="18:00">18:00</option>
                            <option value="19:00">19:00</option>
                            <option value="20:00">20:00</option>
                        </select>
                    </div>
                </div>
                
                <!-- ì˜ˆì•½ ìœ í˜• -->
                <div class="form-group">
                    <label for="consultType"><i class="fas fa-comments"></i> ìƒë‹´ ìœ í˜• *</label>
                    <select id="consultType" name="consultType" required>
                        <option value="">ì„ íƒí•´ì£¼ì„¸ìš”</option>
                        <option value="learning" selected>í•™ìŠµ ìƒë‹´</option>
                        <option value="makeup">ë³´ê°• ìˆ˜ì—…</option>
                        <option value="facility">ì‹œì„¤ ì˜ˆì•½</option>
                    </select>
                </div>
                
                <!-- ì—°ë½ ê°€ëŠ¥ ì‹œê°„ -->
                <div class="form-group">
                    <label for="contactTime"><i class="fas fa-phone-volume"></i> ì—°ë½ ê°€ëŠ¥ ì‹œê°„ *</label>
                    <input type="text" id="contactTime" name="contactTime" required placeholder="ì˜ˆ: í‰ì¼ 18:00-20:00, ì£¼ë§ ì˜¤í›„">
                </div>
                
                <!-- íŠ¹ë³„ ìš”ì²­ì‚¬í•­ -->
                <div class="form-group">
                    <label for="specialRequest"><i class="fas fa-sticky-note"></i> íŠ¹ë³„ ìš”ì²­ì‚¬í•­</label>
                    <textarea id="specialRequest" name="specialRequest" rows="3" placeholder="ìƒë‹´ ì‹œ íŠ¹ë³„íˆ ë‹¤ë¤„ì£¼ì…¨ìœ¼ë©´ í•˜ëŠ” ë‚´ìš©ì´ë‚˜ ê¸°íƒ€ ìš”ì²­ì‚¬í•­ì„ ì ì–´ì£¼ì„¸ìš”."></textarea>
                </div>
                
                <!-- ì•½ê´€ ë™ì˜ -->
                <div class="form-group">
                    <label style="display: flex; align-items: flex-start; gap: 10px;">
                        <input type="checkbox" id="agreeTerms" required style="margin-top: 3px;">
                        <span>ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš©ì— ë™ì˜í•©ë‹ˆë‹¤. (í•„ìˆ˜)</span>
                    </label>
                    <small style="display: block; margin-top: 5px; color: #666;">
                        ìˆ˜ì§‘ëœ ì •ë³´ëŠ” ìƒë‹´ ì˜ˆì•½ ë° ì„œë¹„ìŠ¤ ì œê³µì„ ìœ„í•œ ëª©ì ìœ¼ë¡œë§Œ ì‚¬ìš©ë©ë‹ˆë‹¤.
                    </small>
                </div>
                
                <!-- ë¡œë”© í‘œì‹œ -->
                <div id="loading" class="loading">
                    <div class="loader"></div>
                    <p>ì˜ˆì•½ ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤...</p>
                </div>
                
                <!-- ì„±ê³µ ë©”ì‹œì§€ -->
                <div id="successMessage" class="success-message">
                    <i class="fas fa-check-circle" style="font-size: 3rem; margin-bottom: 15px;"></i>
                    <h3>ì˜ˆì•½ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!</h3>
                    <p>ê´€ë¦¬ìê°€ í™•ì¸ í›„ ì—°ë½ë“œë¦¬ê² ìŠµë‹ˆë‹¤.</p>
                    <p>ì˜ˆì•½ë²ˆí˜¸: <strong id="reservationNumber"></strong></p>
                    <!-- ì´ë©”ì¼ ì•ˆë‚´ ì¶”ê°€ -->
                    <p style="margin-top: 10px; color: #28a745;">
                        <i class="fas fa-envelope"></i> í™•ì¸ ì´ë©”ì¼ì„ ë°œì†¡í–ˆìŠµë‹ˆë‹¤.
                    </p>
                    <button type="button" onclick="goToHome()" class="btn" style="margin-top: 15px;">
                        <i class="fas fa-home"></i> í™ˆìœ¼ë¡œ ì´ë™
                    </button>
                </div>
                
                <!-- ì—ëŸ¬ ë©”ì‹œì§€ -->
                <div id="errorMessage" class="error-message">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span id="errorText">ì˜ˆì•½ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</span>
                </div>
                
                <!-- ì œì¶œ ë²„íŠ¼ -->
                <div class="form-actions">
                    <button type="button" onclick="window.history.back()" class="btn" style="background: #6c757d;">
                        <i class="fas fa-times"></i> ì·¨ì†Œ
                    </button>
                    <button type="submit" class="btn btn-success btn-block" id="submitBtn">
                        <i class="fas fa-paper-plane"></i> ì˜ˆì•½ ì™„ë£Œ
                    </button>
                </div>
            </form>
        </div>
        
        <footer>
            <p>Â© 2025 ë”ë² ìŠ¤íŠ¸ ì–´í•™ì›. All rights reserved.</p>
            <p>ê³ ê°ì„¼í„°: 032-252-9600 | ì´ë©”ì¼: gcha2514@naver.com</p>
            <p>ì¸ì²œ ì—°ìˆ˜êµ¬ ì»¨ë²¤ì‹œì•„ëŒ€ë¡œ 230ë²ˆê¸¸ 42 ì•„ë¼í”„ë¼ì 2ì¸µ 207-1</p>
        </footer>
    </div>

    <script>
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
        document.addEventListener('DOMContentLoaded', function() {
            // ì˜¤ëŠ˜ ë‚ ì§œ ì„¤ì •
            const today = new Date();
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);
            
            const todayStr = today.toISOString().split('T')[0];
            const tomorrowStr = tomorrow.toISOString().split('T')[0];
            
            // ê¸°ë³¸ ì˜ˆì•½ ë‚ ì§œë¥¼ ë‚´ì¼ë¡œ ì„¤ì •
            document.getElementById('reservationDate').value = tomorrowStr;
            document.getElementById('reservationDate').min = tomorrowStr;
            
            // URL íŒŒë¼ë¯¸í„°ì—ì„œ ì˜ˆì•½ ìœ í˜• ê°€ì ¸ì˜¤ê¸°
            const urlParams = new URLSearchParams(window.location.search);
            const type = urlParams.get('type');
            if (type) {
                document.getElementById('consultType').value = type;
            }
            
            // ë‚ ì§œ íŒŒë¼ë¯¸í„°
            const date = urlParams.get('date');
            if (date) {
                document.getElementById('reservationDate').value = date;
            }
            
            console.log('Firestore DB ê°ì²´:', db ? 'âœ… ë¡œë“œë¨' : 'âŒ ì—†ìŒ');
            
            // Firestore ì—°ê²° í…ŒìŠ¤íŠ¸
            testFirestoreConnection();
        });
        
        // Firestore ì—°ê²° í…ŒìŠ¤íŠ¸
        async function testFirestoreConnection() {
            try {
                console.log('Firestore ì—°ê²° í…ŒìŠ¤íŠ¸...');
                await db.collection('reservations').limit(1).get();
                console.log('âœ… Firestore ì—°ê²° ì„±ê³µ');
            } catch (error) {
                console.error('âŒ Firestore ì—°ê²° ì‹¤íŒ¨:', error.message);
                if (error.code === 'permission-denied') {
                    console.error('ğŸ”¥ Firestore ê·œì¹™ í™•ì¸ í•„ìš”: allow read, write: if true;');
                }
            }
        }
        
        // ==================== Formspree ì´ë©”ì¼ í•¨ìˆ˜ ====================
        /**
         * Formspreeë¡œ ì˜ˆì•½ í™•ì¸ ì´ë©”ì¼ ë°œì†¡
         */
        async function sendFormspreeNotification(reservationData, reservationId, docId) {
            const FORMSPREE_FORM_ID = 'mbdlnlzl'; // ì—¬ëŸ¬ë¶„ì˜ Formspree ID
            const FORMSPREE_ENDPOINT = `https://formspree.io/f/${FORMSPREE_FORM_ID}`;
            
            // ìƒë‹´ ìœ í˜• í•œê¸€ ë³€í™˜
            const consultTypeMap = {
                'learning': 'í•™ìŠµ ìƒë‹´',
                'makeup': 'ë³´ê°• ìˆ˜ì—…', 
                'facility': 'ì‹œì„¤ ì˜ˆì•½'
            };
            
            const consultTypeKorean = consultTypeMap[reservationData.type] || reservationData.type;
            
            const emailData = {
                _subject: `ğŸ¯ [ë”ë² ìŠ¤íŠ¸ì–´í•™ì›] ${reservationData.studentName}ë‹˜, ìƒë‹´ ì˜ˆì•½ ì™„ë£Œ!`,
                _replyto: reservationData.parentEmail || 'gcha2514@naver.com',
                
                // Formspree í•„ë“œë“¤
                'ì˜ˆì•½ë²ˆí˜¸': reservationId,
                'í•™ìƒì´ë¦„': reservationData.studentName,
                'í•™ìƒí•™ë…„': reservationData.studentGrade,
                'ë³´í˜¸ìì´ë¦„': reservationData.parentName,
                'ë³´í˜¸ìì—°ë½ì²˜': reservationData.parentPhone,
                'ë³´í˜¸ìì´ë©”ì¼': reservationData.parentEmail || 'ë¯¸ì œê³µ',
                'ìƒë‹´ìœ í˜•': consultTypeKorean,
                'ìƒë‹´ë‚ ì§œ': reservationData.reservationDate,
                'ìƒë‹´ì‹œê°„': reservationData.reservationTime,
                'ì—°ë½ê°€ëŠ¥ì‹œê°„': reservationData.contactTime,
                'íŠ¹ë³„ìš”ì²­': reservationData.specialRequest || 'ì—†ìŒ',
                'ì˜ˆì•½ì¼ì‹œ': new Date().toLocaleString('ko-KR'),
                'ë¬¸ì„œID': docId,
                
                // HTML ë©”ì‹œì§€
                'message': `
<div style="font-family: 'Malgun Gothic', sans-serif; max-width: 600px; margin: auto; background: #f8f9fa; padding: 20px;">
    <div style="background: linear-gradient(135deg, #4A90E2 0%, #357ABD 100%); color: white; padding: 30px; text-align: center; border-radius: 10px 10px 0 0;">
        <h1 style="margin: 0; font-size: 24px;">ë”ë² ìŠ¤íŠ¸ ì–´í•™ì›</h1>
        <p style="margin: 10px 0 0; opacity: 0.9; font-size: 16px;">ìƒë‹´ ì˜ˆì•½ í™•ì¸ ì•ˆë‚´</p>
    </div>
    
    <div style="padding: 30px; background: white;">
        <h2 style="color: #2c3e50; margin-bottom: 20px;">${reservationData.parentName}ë‹˜, ìƒë‹´ ì˜ˆì•½ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!</h2>
        
        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #4A90E2;">
            <h3 style="color: #4A90E2; margin-top: 0;">ğŸ“š ì˜ˆì•½ ì •ë³´</h3>
            <p><strong>ì˜ˆì•½ë²ˆí˜¸:</strong> ${reservationId}</p>
            <p><strong>í•™ìƒì´ë¦„:</strong> ${reservationData.studentName} (${reservationData.studentGrade})</p>
            <p><strong>ë³´í˜¸ìì´ë¦„:</strong> ${reservationData.parentName}</p>
            <p><strong>ë³´í˜¸ìì—°ë½ì²˜:</strong> ${reservationData.parentPhone}</p>
            <p><strong>ìƒë‹´ìœ í˜•:</strong> ${consultTypeKorean}</p>
            <p><strong>ìƒë‹´ë‚ ì§œ:</strong> ${reservationData.reservationDate}</p>
            <p><strong>ìƒë‹´ì‹œê°„:</strong> ${reservationData.reservationTime}</p>
            <p><strong>ì—°ë½ê°€ëŠ¥ì‹œê°„:</strong> ${reservationData.contactTime}</p>
            ${reservationData.specialRequest ? `<p><strong>íŠ¹ë³„ìš”ì²­:</strong> ${reservationData.specialRequest}</p>` : ''}
        </div>
        
        <div style="background: #fff8e1; padding: 15px; border-radius: 5px; border: 1px solid #ffd54f; margin: 20px 0;">
            <h4 style="color: #ff9800; margin-top: 0;">ğŸ“Œ ì•ˆë‚´ì‚¬í•­</h4>
            <ul style="color: #555; margin: 0; padding-left: 20px;">
                <li>ìƒë‹´ 30ë¶„ ì „ê¹Œì§€ ì—°ë½ë“œë¦½ë‹ˆë‹¤</li>
                <li>ë³€ê²½/ì·¨ì†ŒëŠ” ìƒë‹´ 24ì‹œê°„ ì „ê¹Œì§€ ê°€ëŠ¥í•©ë‹ˆë‹¤</li>
                <li>ì¶”ê°€ ë¬¸ì˜: 032-252-9600 (gcha2514@naver.com)</li>
            </ul>
        </div>
        
        <div style="text-align: center; margin: 30px 0;">
            <a href="https://thebestys.github.io/reservation/adminreservation.html" 
               style="background: #4A90E2; color: white; padding: 12px 24px; text-decoration: none; border-radius: 5px; display: inline-block; font-weight: bold; font-size: 16px;">
                ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ í™•ì¸
            </a>
        </div>
    </div>
    
    <div style="text-align: center; color: #666; font-size: 12px; padding: 20px; border-top: 1px solid #eee; background: white;">
        <p>ì¸ì²œ ì—°ìˆ˜êµ¬ ì»¨ë²¤ì‹œì•„ëŒ€ë¡œ 230ë²ˆê¸¸ 42 ì•„ë¼í”„ë¼ì 2ì¸µ 207-1 ë”ë² ìŠ¤íŠ¸ ì–´í•™ì›</p>
        <p>ê³ ê°ì„¼í„°: 032-252-9600 | ì´ë©”ì¼: gcha2514@naver.com</p>
        <p style="color: #999; margin-top: 10px;">ì´ ì´ë©”ì¼ì€ ë°œì‹ ì „ìš©ì…ë‹ˆë‹¤.</p>
    </div>
</div>
                `
            };
            
            try {
                console.log('ğŸ“¤ Formspree ì´ë©”ì¼ ë°œì†¡ ì‹œë„...', emailData);
                
                const response = await fetch(FORMSPREE_ENDPOINT, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(emailData)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    console.log('âœ… Formspree ì´ë©”ì¼ ë°œì†¡ ì„±ê³µ:', result);
                    
                    // Firestoreì— ë¡œê·¸ ì €ì¥
                    try {
                        await db.collection('emailLogs').add({
                            reservationId: reservationId,
                            docId: docId,
                            email: reservationData.parentEmail || 'gcha2514@naver.com',
                            sentAt: new Date(),
                            status: 'sent',
                            via: 'formspree',
                            formId: FORMSPREE_FORM_ID
                        });
                        console.log('ğŸ“ ì´ë©”ì¼ ë¡œê·¸ ì €ì¥ ì™„ë£Œ');
                    } catch (logError) {
                        console.warn('âš ï¸ ë¡œê·¸ ì €ì¥ ì‹¤íŒ¨:', logError);
                    }
                    
                    return { success: true };
                } else {
                    console.warn('âš ï¸ Formspree ì‘ë‹µ ì˜¤ë¥˜:', result);
                    return { success: false, error: result.error };
                }
                
            } catch (error) {
                console.error('âŒ Formspree ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨:', error);
                return { success: false, error: error.message };
            }
        }
        // ==================== Formspree í•¨ìˆ˜ ë ====================
        
        // ì˜ˆì•½ í¼ ì œì¶œ ì²˜ë¦¬
        document.getElementById('reservationForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // ë²„íŠ¼ ìƒíƒœ ì €ì¥
            const submitBtn = document.getElementById('submitBtn');
            const originalText = submitBtn.innerHTML;
            
            // í•„ìˆ˜ ì…ë ¥ í™•ì¸
            const requiredFields = ['studentName', 'studentGrade', 'parentName', 'parentPhone', 
                                   'reservationDate', 'reservationTime', 'consultType', 'contactTime'];
            for (const fieldId of requiredFields) {
                const field = document.getElementById(fieldId);
                if (!field.value.trim()) {
                    alert(`${field.previousElementSibling.textContent}ì„(ë¥¼) ì…ë ¥í•´ì£¼ì„¸ìš”.`);
                    field.focus();
                    return;
                }
            }
            
            if (!document.getElementById('agreeTerms').checked) {
                alert('ê°œì¸ì •ë³´ ì´ìš© ì•½ê´€ì— ë™ì˜í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            try {
                // ë¡œë”© í‘œì‹œ ë° ë²„íŠ¼ ë¹„í™œì„±í™”
                document.getElementById('loading').style.display = 'block';
                document.getElementById('errorMessage').style.display = 'none';
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ì²˜ë¦¬ ì¤‘...';
                
                // ì˜ˆì•½ ë°ì´í„° ì¤€ë¹„
                const reservationData = {
                    // í•™ìƒ ì •ë³´
                    studentName: document.getElementById('studentName').value.trim(),
                    studentGrade: document.getElementById('studentGrade').value,
                    
                    // ë³´í˜¸ì ì •ë³´
                    parentName: document.getElementById('parentName').value.trim(),
                    parentPhone: document.getElementById('parentPhone').value.trim(),
                    parentEmail: document.getElementById('parentEmail').value.trim(),
                    
                    // ì˜ˆì•½ ì •ë³´
                    type: document.getElementById('consultType').value,
                    reservationDate: document.getElementById('reservationDate').value,
                    reservationTime: document.getElementById('reservationTime').value,
                    
                    // ê¸°íƒ€ ì •ë³´
                    contactTime: document.getElementById('contactTime').value.trim(),
                    specialRequest: document.getElementById('specialRequest').value.trim(),
                    
                    // ì‹œìŠ¤í…œ ì •ë³´
                    status: 'pending',
                    reservationId: generateReservationId(),
                    createdAt: new Date(),
                    updatedAt: new Date()
                };
                
                console.log('ğŸ“ ì €ì¥í•  ë°ì´í„°:', reservationData);
                
                // Firestoreì— ì €ì¥
                const docRef = await db.collection('reservations').add(reservationData);
                const docId = docRef.id;
                
                console.log('âœ… Firestore ì €ì¥ ì„±ê³µ! ë¬¸ì„œ ID:', docId);
                console.log('ğŸ“‹ ì˜ˆì•½ë²ˆí˜¸:', reservationData.reservationId);
                
                // ========== ğŸŒŸ Formspree ì´ë©”ì¼ ë°œì†¡ ==========
                console.log('ğŸ“§ Formspree ì´ë©”ì¼ ë°œì†¡ ì‹œì‘...');
                const emailResult = await sendFormspreeNotification(reservationData, reservationData.reservationId, docId);
                
                if (emailResult.success) {
                    console.log('âœ… ì´ë©”ì¼ ë°œì†¡ ì™„ë£Œ');
                } else {
                    console.warn('âš ï¸ ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨ (ë¬´ì‹œ ê°€ëŠ¥):', emailResult.error);
                    // ì´ë©”ì¼ ì‹¤íŒ¨í•´ë„ ì˜ˆì•½ì€ ì„±ê³µí–ˆìœ¼ë¯€ë¡œ ë¬´ì‹œ
                }
                
                // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
                document.getElementById('loading').style.display = 'none';
                document.getElementById('reservationForm').style.display = 'none';
                document.getElementById('reservationNumber').textContent = reservationData.reservationId;
                document.getElementById('successMessage').style.display = 'block';
                
                // ì½˜ì†”ì— ì„±ê³µ ë©”ì‹œì§€
                console.log('ğŸ‰ ì˜ˆì•½ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
                console.log('ğŸ“Š ì˜ˆì•½ë²ˆí˜¸:', reservationData.reservationId);
                console.log('ğŸ“„ ë¬¸ì„œ ID:', docId);
                console.log('ğŸ“§ ì´ë©”ì¼ ë°œì†¡:', emailResult.success ? 'ì„±ê³µ' : 'ì‹¤íŒ¨');
                
            } catch (error) {
                console.error('âŒ ì˜ˆì•½ ì²˜ë¦¬ ì‹¤íŒ¨:', error);
                
                // ë²„íŠ¼ ìƒíƒœ ë³µì›
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalText;
                
                document.getElementById('loading').style.display = 'none';
                document.getElementById('errorMessage').style.display = 'block';
                document.getElementById('errorText').textContent = 
                    `ì˜ˆì•½ ì²˜ë¦¬ ì‹¤íŒ¨: ${error.message}`;
                
                if (error.code === 'permission-denied') {
                    alert('Firestore ì“°ê¸° ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.\nFirebase ì½˜ì†”ì—ì„œ Firestore ê·œì¹™ì„ í™•ì¸í•˜ì„¸ìš”.');
                }
            }
        });
        
        // ì˜ˆì•½ë²ˆí˜¸ ìƒì„±
        function generateReservationId() {
            const now = new Date();
            const dateStr = now.getFullYear().toString() + 
                           (now.getMonth() + 1).toString().padStart(2, '0') + 
                           now.getDate().toString().padStart(2, '0');
            const randomStr = Math.random().toString(36).substr(2, 6).toUpperCase();
            return `RES${dateStr}${randomStr}`;
        }
        
        // í™ˆìœ¼ë¡œ ì´ë™
        function goToHome() {
            window.location.href = 'index.html';
        }
        
        // ì „í™”ë²ˆí˜¸ í¬ë§·íŒ…
        document.getElementById('parentPhone').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 3 && value.length <= 7) {
                value = value.replace(/(\d{3})(\d+)/, '$1-$2');
            } else if (value.length > 7) {
                value = value.replace(/(\d{3})(\d{4})(\d+)/, '$1-$2-$3');
            }
            e.target.value = value;
        });
    </script>
</body>
</html>
