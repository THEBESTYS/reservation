<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì´ë©”ì¼ ë°œì†¡ ì¤‘ - ë”ë² ìŠ¤íŠ¸ ì–´í•™ì›</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Malgun Gothic', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            text-align: center;
        }
        
        .logo {
            font-size: 3rem;
            color: #667eea;
            margin-bottom: 20px;
        }
        
        h1 {
            color: #333;
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 30px;
        }
        
        .reservation-info {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin: 25px 0;
            text-align: left;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        @media (max-width: 500px) {
            .info-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .info-item {
            margin-bottom: 12px;
        }
        
        .info-label {
            font-weight: bold;
            color: #555;
            font-size: 0.9rem;
            margin-bottom: 3px;
        }
        
        .info-value {
            color: #333;
            font-size: 1rem;
        }
        
        .special-request {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
            padding: 15px;
            margin-top: 15px;
            border-radius: 5px;
        }
        
        .special-request h4 {
            color: #e65100;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .loading {
            margin: 30px 0;
        }
        
        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .message {
            padding: 25px;
            border-radius: 10px;
            margin: 20px 0;
            display: none;
        }
        
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            margin-top: 20px;
            transition: background 0.3s;
        }
        
        .btn:hover {
            background: #5a67d8;
        }
        
        .email-notice {
            background: #e3f2fd;
            border: 1px solid #bbdefb;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            text-align: left;
        }
        
        .email-notice h4 {
            color: #1976d2;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">
            <i class="fas fa-envelope-open-text"></i>
        </div>
        
        <h1>ì˜ˆì•½ í™•ì¸ ì´ë©”ì¼ ë°œì†¡</h1>
        <p class="subtitle">ì…ë ¥í•˜ì‹  ì´ë©”ì¼ë¡œ í™•ì¸ì„œê°€ ë°œì†¡ë©ë‹ˆë‹¤</p>
        
        <div class="reservation-info" id="reservationInfo">
            <!-- ì˜ˆì•½ ì •ë³´ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
        </div>
        
        <div class="loading" id="loading">
            <div class="loader"></div>
            <p>ì´ë©”ì¼ ë°œì†¡ ì¤‘ì…ë‹ˆë‹¤...</p>
        </div>
        
        <div class="message success" id="successMessage">
            <i class="fas fa-check-circle" style="font-size: 3rem; margin-bottom: 15px;"></i>
            <h3>ì´ë©”ì¼ ë°œì†¡ ì™„ë£Œ!</h3>
            <p>í™•ì¸ ì´ë©”ì¼ì´ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
            
            <div class="email-notice">
                <h4><i class="fas fa-info-circle"></i> ì´ë©”ì¼ ì•ˆë‚´</h4>
                <p style="margin-bottom: 5px;"><strong>ë°œì†¡ ì´ë©”ì¼:</strong> <span id="sentEmail"></span></p>
                <p style="font-size: 0.9rem; color: #555; margin-top: 5px;">
                    <i class="fas fa-exclamation-circle"></i>
                    ì´ë©”ì¼ì´ ë³´ì´ì§€ ì•Šìœ¼ë©´ ìŠ¤íŒ¸í•¨ì„ í™•ì¸í•´ì£¼ì„¸ìš”.
                </p>
            </div>
            
            <p style="margin: 15px 0; color: #555;">
                ê´€ë¦¬ìê°€ ì˜ˆì•½ì„ í™•ì¸ í›„ ì—°ë½ë“œë¦¬ê² ìŠµë‹ˆë‹¤.
            </p>
            
            <a href="index.html" class="btn">
                <i class="fas fa-home"></i> í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°
            </a>
        </div>
        
        <div class="message error" id="errorMessage">
            <i class="fas fa-exclamation-triangle" style="font-size: 3rem; margin-bottom: 15px;"></i>
            <h3>ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨</h3>
            <p id="errorText">ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.</p>
            
            <div style="margin: 20px 0; padding: 15px; background: #ffebee; border-radius: 5px;">
                <p><strong>í•´ê²° ë°©ë²•:</strong></p>
                <p style="font-size: 0.9rem; margin-top: 8px;">
                    1. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨(F5) í•´ë³´ì„¸ìš”<br>
                    2. ì´ë©”ì¼ ì£¼ì†Œë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”<br>
                    3. ë¬¸ì œê°€ ì§€ì†ë˜ë©´ í•™ì›ìœ¼ë¡œ ì—°ë½ì£¼ì„¸ìš”
                </p>
            </div>
            
            <a href="index.html" class="btn">
                <i class="fas fa-arrow-left"></i> ëŒì•„ê°€ê¸°
            </a>
        </div>
    </div>

    <script>
        const FORMSPREE_ENDPOINT = 'https://formspree.io/f/mjggbrog';
        
        document.addEventListener('DOMContentLoaded', async function() {
            // URL íŒŒë¼ë¯¸í„°ì—ì„œ ëª¨ë“  ì˜ˆì•½ ë°ì´í„° ì¶”ì¶œ
            const urlParams = new URLSearchParams(window.location.search);
            const reservationData = {
                reservationId: urlParams.get('reservationId'),
                studentName: urlParams.get('studentName'),
                studentGrade: urlParams.get('studentGrade'),
                parentName: urlParams.get('parentName'),
                parentEmail: urlParams.get('parentEmail'),
                parentPhone: urlParams.get('parentPhone'),
                reservationDate: urlParams.get('reservationDate'),
                reservationTime: urlParams.get('reservationTime'),
                consultType: urlParams.get('consultType'),
                contactTime: urlParams.get('contactTime'),
                specialRequest: urlParams.get('specialRequest'),
                source: urlParams.get('source')
            };
            
            // ë””ë²„ê¹…: URL íŒŒë¼ë¯¸í„° í™•ì¸
            console.log('ğŸ“‹ ë°›ì€ ì˜ˆì•½ ë°ì´í„°:', reservationData);
            
            // ë°ì´í„° ìœ íš¨ì„± ê²€ì‚¬
            if (!reservationData.parentEmail) {
                showError('ì´ë©”ì¼ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤. ì˜ˆì•½ í˜ì´ì§€ì—ì„œ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ì˜ˆì•½ ì •ë³´ í‘œì‹œ
            displayReservationInfo(reservationData);
            
            // ì´ë©”ì¼ ë°œì†¡
            await sendEmail(reservationData);
        });
        
        function displayReservationInfo(data) {
            const container = document.getElementById('reservationInfo');
            
            let html = `
                <div class="info-grid">
                    <div class="info-item">
                        <div class="info-label">ì˜ˆì•½ë²ˆí˜¸</div>
                        <div class="info-value"><strong>${data.reservationId || 'ì—†ìŒ'}</strong></div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">í•™ìƒ ì´ë¦„</div>
                        <div class="info-value">${data.studentName || 'ì—†ìŒ'}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">í•™ë…„/ë°˜</div>
                        <div class="info-value">${getGradeText(data.studentGrade) || 'ì—†ìŒ'}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">ë³´í˜¸ì</div>
                        <div class="info-value">${data.parentName || 'ì—†ìŒ'}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">ì—°ë½ì²˜</div>
                        <div class="info-value">${data.parentPhone || 'ì—†ìŒ'}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">ì´ë©”ì¼</div>
                        <div class="info-value">${data.parentEmail || 'ì—†ìŒ'}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">ì˜ˆì•½ì¼ì‹œ</div>
                        <div class="info-value">${data.reservationDate || 'ì—†ìŒ'} ${data.reservationTime || 'ì—†ìŒ'}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">ìƒë‹´ìœ í˜•</div>
                        <div class="info-value">${getConsultTypeText(data.consultType)}</div>
                    </div>
                </div>
            `;
            
            // ì—°ë½ ê°€ëŠ¥ ì‹œê°„ ì¶”ê°€
            if (data.contactTime) {
                html += `
                    <div class="info-item" style="margin-top: 10px;">
                        <div class="info-label">ì—°ë½ ê°€ëŠ¥ ì‹œê°„</div>
                        <div class="info-value">${data.contactTime}</div>
                    </div>
                `;
            }
            
            // íŠ¹ë³„ ìš”ì²­ì‚¬í•­ ì¶”ê°€
            if (data.specialRequest) {
                html += `
                    <div class="special-request">
                        <h4><i class="fas fa-sticky-note"></i> íŠ¹ë³„ ìš”ì²­ì‚¬í•­</h4>
                        <p>${data.specialRequest}</p>
                    </div>
                `;
            }
            
            container.innerHTML = html;
            
            // ì„±ê³µ ì‹œ ì´ë©”ì¼ ì£¼ì†Œ í‘œì‹œ ì¤€ë¹„
            document.getElementById('sentEmail').textContent = data.parentEmail;
        }
        
        async function sendEmail(reservationData) {
            try {
                console.log('ğŸ“§ Formspree ì´ë©”ì¼ ë°œì†¡ ì‹œì‘...');
                
                const formData = new FormData();
                
                // Formspree í•„ìˆ˜ í•„ë“œ
                formData.append('email', reservationData.parentEmail);
                formData.append('subject', `[ë”ë² ìŠ¤íŠ¸ì–´í•™ì›] ${reservationData.studentName}ë‹˜ ì˜ˆì•½ ì™„ë£Œ (${reservationData.reservationId})`);
                formData.append('_replyto', reservationData.parentEmail);
                formData.append('_language', 'ko');
                formData.append('_format', 'plain');
                
                // ì´ë©”ì¼ ë³¸ë¬¸ êµ¬ì„±
                const emailBody = `
ì•ˆë…•í•˜ì„¸ìš”, ${reservationData.parentName}ë‹˜!

ë”ë² ìŠ¤íŠ¸ ì–´í•™ì› í•™ìŠµ ìƒë‹´ ì˜ˆì•½ì´ ì •ìƒì ìœ¼ë¡œ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤.

â–¸ ì˜ˆì•½ë²ˆí˜¸: ${reservationData.reservationId}
â–¸ í•™ìƒ ì´ë¦„: ${reservationData.studentName}
â–¸ í•™ë…„/ë°˜: ${getGradeText(reservationData.studentGrade)}
â–¸ ì˜ˆì•½ì¼ì‹œ: ${reservationData.reservationDate} ${reservationData.reservationTime}
â–¸ ìƒë‹´ìœ í˜•: ${getConsultTypeText(reservationData.consultType)}
â–¸ ì—°ë½ ê°€ëŠ¥ ì‹œê°„: ${reservationData.contactTime || 'ì—†ìŒ'}

${reservationData.specialRequest ? `â–¸ íŠ¹ë³„ ìš”ì²­ì‚¬í•­: ${reservationData.specialRequest}\n` : ''}
ì˜ˆì•½ ê´€ë ¨ ë¬¸ì˜ì‚¬í•­ì€ 032-252-9600ìœ¼ë¡œ ì—°ë½ì£¼ì„¸ìš”.

ê°ì‚¬í•©ë‹ˆë‹¤.
ë”ë² ìŠ¤íŠ¸ ì–´í•™ì›
ì¸ì²œ ì—°ìˆ˜êµ¬ ì»¨ë²¤ì‹œì•„ëŒ€ë¡œ 230ë²ˆê¸¸ 42 ì•„ë¼í”„ë¼ì 2ì¸µ 207-1
                `;
                
                formData.append('message', emailBody);
                
                // ì¶”ê°€ ë°ì´í„° (Formspreeì—ì„œ ë³´ê¸° í¸í•˜ê²Œ)
                formData.append('ì˜ˆì•½ë²ˆí˜¸', reservationData.reservationId);
                formData.append('í•™ìƒì´ë¦„', reservationData.studentName);
                formData.append('í•™ë…„ë°˜', getGradeText(reservationData.studentGrade));
                formData.append('ë³´í˜¸ìì´ë¦„', reservationData.parentName);
                formData.append('ì—°ë½ì²˜', reservationData.parentPhone);
                formData.append('ì´ë©”ì¼', reservationData.parentEmail);
                formData.append('ì˜ˆì•½ë‚ ì§œ', reservationData.reservationDate);
                formData.append('ì˜ˆì•½ì‹œê°„', reservationData.reservationTime);
                formData.append('ìƒë‹´ìœ í˜•', getConsultTypeText(reservationData.consultType));
                
                if (reservationData.contactTime) {
                    formData.append('ì—°ë½ê°€ëŠ¥ì‹œê°„', reservationData.contactTime);
                }
                
                if (reservationData.specialRequest) {
                    formData.append('íŠ¹ë³„ìš”ì²­ì‚¬í•­', reservationData.specialRequest);
                }
                
                // ë””ë²„ê¹…: FormData ë‚´ìš© í™•ì¸
                console.log('ğŸ“¤ Formspree ì „ì†¡ ë°ì´í„°:');
                for (let [key, value] of formData.entries()) {
                    console.log(`  ${key}:`, value);
                }
                
                // ì´ë©”ì¼ ë°œì†¡
                const response = await fetch(FORMSPREE_ENDPOINT, {
                    method: 'POST',
                    body: formData,
                    headers: { 'Accept': 'application/json' }
                });
                
                console.log('ğŸ“¨ Formspree ì‘ë‹µ:', response.status, response.statusText);
                
                document.getElementById('loading').style.display = 'none';
                
                if (response.ok) {
                    const result = await response.json();
                    console.log('âœ… Formspree ë°œì†¡ ì„±ê³µ:', result);
                    document.getElementById('successMessage').style.display = 'block';
                    
                    // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— ë°œì†¡ ê¸°ë¡ ì €ì¥
                    saveEmailLog(reservationData);
                } else {
                    const errorText = await response.text();
                    console.error('âŒ Formspree ë°œì†¡ ì‹¤íŒ¨:', errorText);
                    throw new Error(`ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨: ${response.status}`);
                }
                
            } catch (error) {
                console.error('âŒ ì´ë©”ì¼ ë°œì†¡ ì˜¤ë¥˜:', error);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('errorMessage').style.display = 'block';
                document.getElementById('errorText').textContent = 
                    error.message || 'ì´ë©”ì¼ ë°œì†¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
            }
        }
        
        function getConsultTypeText(type) {
            const types = {
                'learning': 'í•™ìŠµ ìƒë‹´',
                'makeup': 'ë³´ê°• ìˆ˜ì—…',
                'facility': 'ì‹œì„¤ ì˜ˆì•½'
            };
            return types[type] || type || 'ì—†ìŒ';
        }
        
        function getGradeText(grade) {
            const grades = {
                'ì´ˆ1': 'ì´ˆë“±í•™êµ 1í•™ë…„',
                'ì´ˆ2': 'ì´ˆë“±í•™êµ 2í•™ë…„',
                'ì´ˆ3': 'ì´ˆë“±í•™êµ 3í•™ë…„',
                'ì´ˆ4': 'ì´ˆë“±í•™êµ 4í•™ë…„',
                'ì´ˆ5': 'ì´ˆë“±í•™êµ 5í•™ë…„',
                'ì´ˆ6': 'ì´ˆë“±í•™êµ 6í•™ë…„',
                'ì¤‘1': 'ì¤‘í•™êµ 1í•™ë…„',
                'ì¤‘2': 'ì¤‘í•™êµ 2í•™ë…„',
                'ì¤‘3': 'ì¤‘í•™êµ 3í•™ë…„',
                'ê³ 1': 'ê³ ë“±í•™êµ 1í•™ë…„',
                'ê³ 2': 'ê³ ë“±í•™êµ 2í•™ë…„',
                'ê³ 3': 'ê³ ë“±í•™êµ 3í•™ë…„'
            };
            return grades[grade] || grade || 'ì—†ìŒ';
        }
        
        function saveEmailLog(reservationData) {
            try {
                const logs = JSON.parse(localStorage.getItem('email_logs') || '[]');
                logs.push({
                    reservationId: reservationData.reservationId,
                    email: reservationData.parentEmail,
                    sentAt: new Date().toLocaleString('ko-KR'),
                    status: 'sent'
                });
                localStorage.setItem('email_logs', JSON.stringify(logs));
                console.log('ğŸ’¾ ì´ë©”ì¼ ë°œì†¡ ê¸°ë¡ ì €ì¥ë¨');
            } catch (error) {
                console.warn('âš ï¸ ì´ë©”ì¼ ë¡œê·¸ ì €ì¥ ì‹¤íŒ¨:', error);
            }
        }
        
        function showError(message) {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('errorMessage').style.display = 'block';
            document.getElementById('errorText').textContent = message;
        }
    </script>
</body>
</html>
